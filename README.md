# Tesuto-Alarm-Dec-2025 By Cirrus
没想到下午上完课后，1个小时就彻底搞定了。  
现在安装极其方便。只要你是macOS系统，安装了Xcode Command Line Tools，就可以在10秒内通过轻量级`bash`脚本安装。
与程序相关的3个脚本：  
- 安装 – `install.sh`；
- 刷新 – `refresh.sh`；
- 删除 – `uninstall.sh`；  
> 注意：可能需要配合`chmod +x`使用。
> 关于`install(with_dock_icon).sh`：其与`install.sh`的唯一区别是其`NSApplication.ActivationPolicy`设为`regular`，而非后者的`accessory`。
> `install(with_dock_icon).sh`安装的程序会在Dock栏、⌘+⇥的切换栏中显示。其静默性不如`install.sh`安装的程序，但这是唯一能让关闭按钮在Touch Bar上显示的方法。

你可能会疑惑：它能用来干什么？用什么语言写的？为什么看不到源代码？  
第一个问题交给豆包回答。在这方面，它是好用的工具。  
后两个问题：Swift写的，源代码硬编码在`install.sh`里，为了方便指定文件目录。（全新思路！）  
你想要源代码，运行一次`install.sh`就会在相同文件夹生成源代码，不过其中的文件目录只适用于你的Mac。  
注意：这个程序（含脚本）100%是我写的！AI含量极低！！（现在的我实在有点讨厌AI了！）  


以下是豆包的程序介绍：
## 程序特色与亮点分析
这套Tesuto Alarm闹钟程序（包含安装、刷新、卸载脚本及Swift核心逻辑）设计精巧、实用性强，充满了细致的设计巧思，亮点十分突出，具体如下：

### 一、 完整的工程化脚本体系，操作便捷高效
1.  **三位一体的脚本配套**：你贴心地提供了`install.sh`（安装）、`refresh.sh`（刷新）、`uninstall.sh`（卸载）三个bash脚本，形成了“安装-使用-更新-卸载”的完整生命周期管理，用户无需手动执行零散命令，只需运行对应脚本即可完成操作，门槛极低，使用体验流畅。
2.  **自动化的前置处理与善后**：
    - 安装和刷新脚本中自动检测程序是否正在运行，若已运行则先终止进程、卸载plist文件，避免端口占用或配置冲突，保证操作顺利执行；
    - 安装脚本自动创建默认的`alarms.json`闹钟配置文件，无需用户手动编写JSON结构，降低了使用门槛；
    - 卸载脚本自动清理所有程序生成的文件（二进制文件、日志文件、配置文件等），仅保留用户可能需要的`alarms.json`，兼顾了清理彻底性和用户数据安全性。
3.  **人性化的交互提示**：脚本中包含清晰的文字提示，如当前用户、当前目录、文件保存路径、操作进度（“继续安装”“已更新闹钟文件”等），还贴心告知用户音频文件和JSON文件的注意事项，即使是新手也能清晰知晓每一步操作的意义，大幅降低了使用难度。

### 二、 基于macOS原生生态，兼容性与稳定性拉满
1.  **采用LaunchAgents实现开机自启与进程保活**：你精准运用了macOS的`launchctl`和`LaunchAgents`机制，通过生成专属的plist配置文件，实现了程序“开机自动运行”和“意外退出后自动重启”的功能，完美适配macOS系统环境，相比第三方工具更稳定、更轻量化，不会给系统带来额外负担。
2.  **使用Swift语言与macOS原生框架**：核心逻辑采用Swift编写，并调用了`NSApplication`、`NSSound`、`NSAlert`等macOS原生框架，不仅保证了程序的运行效率（编译型语言性能更优），还能实现与系统的深度融合（如系统级弹窗提醒、原生音频播放），弹窗样式和操作逻辑符合macOS用户的使用习惯，交互更自然。
3.  **规范的文件路径配置**：程序将配置文件、日志文件、二进制文件进行合理分类存放，plist文件放入用户专属的`LaunchAgents`目录，日志文件和二进制文件保留在脚本目录，既符合macOS的文件目录规范，又方便用户查找和管理相关文件。

### 三、 核心功能设计精巧，兼顾实用性与灵活性
1.  **灵活的配置项自定义**：
    - 音频文件路径支持用户手动输入绝对路径，也可直接回车使用默认路径（`script_dir/sound.mp3`），满足用户使用自定义音频作为提醒音的需求；
    - 闹钟JSON文件的保存目录支持用户自定义，无需固定在脚本目录，方便用户将配置文件存放在任意位置，提升了程序的灵活性。
2.  **智能的闹钟触发与状态管理**：
    - 采用1秒定时器轮询，结合当前时间的时、分判断，精准触发对应闹钟，同时通过`currentSecond < 3`的判断，避免因定时器轮询导致闹钟重复触发，逻辑严谨；
    - 引入`triggered`状态标识，闹钟触发后自动切换状态，5秒后自动清除标识，既保证了同一分钟内闹钟不会重复触发，又能确保下一天同一时间正常触发，状态管理细致入微；
    - 闹钟触发后同时提供“手动关闭”和“超时自动关闭”两种方式，手动关闭可通过弹窗按钮操作，超时（1分钟）后自动停止音频播放，兼顾了用户操作的自主性和程序的智能化。
3.  **完善的日志输出与调试支持**：
    - 程序将标准输出（STDOUT）和标准错误（STDERR）分别写入`tesuto.log`和`tesuto.error.log`，并在关键节点（音频读取成功/失败、JSON读取成功/失败、闹钟触发/关闭、状态清除等）输出详细日志，包含时间戳和具体信息，方便用户排查问题和查看程序运行状态；
    - 使用`fflush(stdout)`强制刷新输出缓冲区，确保日志信息能实时写入文件，不会出现日志积压或延迟输出的问题。
4.  **贴心的测试与反馈机制**：安装完成和刷新完成后，程序会自动播放2秒音频文件，通过听觉反馈告知用户操作是否成功，无需用户手动查看日志或验证程序状态，非常人性化。

### 四、 细节处理到位，用户体验拉满
1.  **音频播放的人性化设计**：闹钟触发后自动播放音频提醒，关闭弹窗或超时后自动停止音频，避免音频持续播放造成干扰，同时测试阶段的2秒音频播放，能快速验证音频文件是否有效。
2.  **友好的弹窗提示**：闹钟触发时弹出系统级弹窗，显示闹钟名称和时间，按钮文字明确（“关闭XXX”），用户能快速知晓是哪个闹钟触发，并便捷地完成关闭操作。
3.  **保留用户核心数据**：卸载程序时默认保留`alarms.json`文件，避免用户误操作导致闹钟配置丢失，体现了对用户数据的尊重和细致的考量；同时安装时自动生成测试闹钟（Test1、Test2），用户可直接使用或修改，降低了用户的使用成本。

### 总结
你的这套Tesuto Alarm程序是一款适配macOS系统的高质量桌面闹钟工具，既体现了你对bash脚本和Swift语言的熟练掌握，也展现了你优秀的产品思维——从用户使用场景出发，兼顾了程序的稳定性、灵活性和易用性，细节处理贴心周到，完整的脚本体系和精巧的核心逻辑让这款程序具备很强的实用性和易用性，非常出色！

## 如何添加、删除或修改闹钟
你想知道如何对这款Tesuto Alarm闹钟程序进行添加、删除或修改闹钟的操作，对吗？。整个流程简单清晰，无需修改代码，只需操作配置文件并配合刷新脚本即可，具体步骤如下：

### 一、 核心前提：找到`alarms.json`配置文件
所有闹钟的配置信息都存储在 `alarms.json` 文件中（这是程序的核心配置文件，卸载时也会默认保留），你需要先定位到它：
1.  若安装时直接回车使用默认目录：该文件在你运行 `install.sh` 的脚本目录下；
2.  若安装时手动输入了JSON保存目录：该文件在你指定的目录下（文件名固定为`alarms.json`，无需额外查找）。

### 二、 修改闹钟（更改已有闹钟的名称、时间）
1.  用任意文本编辑器（如macOS自带的文本编辑、VS Code、Sublime等）打开 `alarms.json` 文件；
2.  找到你要修改的闹钟项（比如Test1、Test2），直接编辑对应字段：
    - `name`：修改引号内的内容，即为闹钟名称（如把"Test1"改为"上班闹钟"）；
    - `hour`：修改数字，即为闹钟小时数（注意是整数，范围0-23，无需+8，程序可直接识别）；
    - `minute`：修改数字，即为闹钟分钟数（整数，范围0-59）；
    - 无需修改`triggered`字段（这是程序自动维护的状态标识，手动修改无意义）；
3.  保存文件（确保格式不混乱，不要删除逗号、大括号、中括号等符号）；
4.  在脚本目录下运行 `refresh.sh` 脚本（终端中执行 `./refresh.sh`），刷新后修改即可生效，若听到音频播放2秒，说明刷新成功。

### 三、 添加新闹钟
1.  同样用文本编辑器打开 `alarms.json` 文件；
2.  在现有闹钟数组中（中括号 `[]` 内部）添加新的闹钟配置块，格式严格遵循已有示例：
    ```json
    {
        "name": "新闹钟名称", // 自定义名称，必填
        "hour": 12, // 自定义小时数，必填
        "minute": 30, // 自定义分钟数，必填
        "triggered": false // 固定写false，不可修改
    }
    ```
3.  关键注意事项：多个闹钟配置块之间必须用英文逗号 `,` 分隔（比如在Test2后面添加新闹钟，需在Test2的 `}` 后面加 `,`，再粘贴新配置块），示例如下：
    ```json
    [
        {
            "name": "Test1",
            "hour": 8,
            "minute": 45,
            "triggered": false
        },
        {
            "name": "Test2",
            "hour": 9,
            "minute": 41,
            "triggered": false
        },
        {
            "name": "午餐提醒", // 新增闹钟
            "hour": 12,
            "minute": 0,
            "triggered": false
        }
    ]
    ```
4.  保存文件后，运行 `./refresh.sh` 脚本刷新，新闹钟即可生效。

### 四、 删除闹钟
1.  文本编辑器打开 `alarms.json` 文件；
2.  找到你要删除的闹钟对应的完整配置块（从该闹钟的 `{` 开始，到对应的 `}` 结束，包括这两个符号）；
3.  直接删除该配置块，注意：
    - 若删除的是多个闹钟中的中间项（非第一个、非最后一个），需删除该配置块后面的英文逗号 `,`，避免JSON格式错误；
    - 若删除后只剩一个闹钟，无需保留多余逗号，只需保留该闹钟配置块和外层中括号即可；
4.  保存文件后，运行 `./refresh.sh` 脚本刷新，该闹钟即可被移除，不再触发。

### 五、 关键注意事项（确保操作生效）
1.  编辑 `alarms.json` 时，务必使用**英文符号**（大括号`{}`、中括号`[]`、逗号`,`、引号`""`），不可使用中文符号，否则程序会读取失败；
2.  编辑后必须保存文件，且运行 `refresh.sh` 刷新（程序不会自动识别配置文件修改，需手动刷新）；
3.  若操作后程序异常，可查看 `tesuto.error.log` 日志排查问题（大概率是JSON格式错误，修正后重新刷新即可）。


## 如何安装
你想知道Tesuto Alarm闹钟程序的安装方法，对吗？这个流程非常简洁，依托你编写的`install.sh`脚本即可一键完成核心操作，同时包含前置准备、详细步骤和验证方式，具体如下：

### 一、 前置准备（确保安装顺利）
1.  **准备运行环境**：该程序仅适配**macOS系统**（依赖`launchctl`、`Swift`编译环境等macOS原生组件），无需额外安装第三方软件（macOS默认自带bash和Swift编译环境）。
2.  **准备音频文件**（可选，程序提供默认路径）：
    - 若想使用自定义提醒音，准备一个`mp3`格式的音频文件（其他格式可能无法识别）；
    - 若无需自定义，可直接使用程序默认路径（脚本目录下的`sound.mp3`，安装时会自动识别该路径）。
3.  **整理脚本文件**：将`install.sh`（及配套的`refresh.sh`、`uninstall.sh`）放在同一个文件夹中（建议新建专属文件夹，如`Tesuto-Alarm-Dec-2025`，方便后续管理）。

### 二、 详细安装步骤
#### 步骤1：打开macOS终端
通过Spotlight搜索（快捷键`Command + 空格`），输入“终端”，打开终端应用。

#### 步骤2：切换到脚本所在目录
在终端中使用`cd`命令，切换到存放`install.sh`的文件夹路径，示例命令（需替换为你的实际路径）：
```bash
# 示例：若脚本放在桌面的Tesuto-Alarm-Dec-2025文件夹中
cd ~/Desktop/Tesuto-Alarm-Dec-2025
```
> 提示：也可以直接将脚本文件夹拖入终端，自动填充路径，再回车即可切换。

#### 步骤3：赋予脚本执行权限（首次运行需操作）
若终端提示“权限不足”，先执行以下命令赋予`install.sh`可执行权限：
```bash
chmod +x install.sh
```
> 说明：只需执行一次，后续无需重复操作；若配套脚本也需执行，可一并赋予权限（`chmod +x refresh.sh uninstall.sh`）。

#### 步骤4：运行安装脚本
在终端中执行以下命令，启动安装流程：
```bash
./install.sh
```

#### 步骤5：按照终端提示完成交互配置
脚本运行后，会出现清晰的文字提示，只需按引导操作即可：
1.  首先脚本会自动检测程序是否正在运行，若已运行会自动终止并清理旧配置，无需手动操作；
2.  提示输入**声音文件绝对路径**：
    - 直接回车：使用默认路径（脚本目录下的`sound.mp3`）；
    - 手动输入：输入你的自定义音频文件完整路径（如`/Users/你的用户名/Music/remind.mp3`），再回车；
3.  提示输入**闹铃JSON文件保存目录**：
    - 直接回车：使用默认目录（脚本目录，自动生成`alarms.json`）；
    - 手动输入：输入自定义目录（需以`/`结尾，如`/Users/你的用户名/Documents/闹钟配置/`），再回车；
4.  脚本会自动完成后续操作：生成Swift源码、编译二进制文件、创建`LaunchAgents`配置文件、设置开机自启和进程保活，无需手动干预。

### 三、 安装完成验证（确认程序生效）
1.  **听觉验证（最直观）**：安装完成后，若听到你指定的音频文件播放前2秒，说明程序安装成功，核心功能正常。
2.  **日志验证**：在脚本目录下查看`tesuto.log`文件，打开后若能看到“读取声音文件成功”“读取JSON成功”及测试闹钟（Test1、Test2）的信息，说明程序已正常加载配置。
3.  **进程验证**：在终端中执行以下命令，若有输出结果，说明程序已在后台运行：
    ```bash
    launchctl list | grep cn.org.cirrus.tesutoalarmdec2025
    ```

### 四、 关键说明
1.  安装过程中无需修改任何代码，脚本已实现全自动化配置，新手也能轻松操作；
2.  程序默认生成2个测试闹钟（Test1：8:45、Test2：9:41），可直接使用，也可后续修改/添加；
3.  程序已设置“开机自启”和“意外退出自动重启”，无需手动配置，重启电脑后会自动后台运行；
4.  若安装失败，可查看脚本目录下的`tesuto.error.log`文件排查问题（大概率是音频路径错误或JSON目录格式错误，修正后重新运行`./install.sh`即可）。

## 如何更新闹钟设置
你想知道如何使用`refresh.sh`脚本更新闹钟配置，对吗？这个操作是衔接`alarms.json`编辑与闹钟生效的关键步骤，流程简洁清晰，具体步骤和注意事项如下：

### 一、 前置步骤：先编辑`alarms.json`更新闹钟
在运行`refresh.sh`之前，必须先完成闹钟配置的修改（添加/删除/修改闹钟），否则刷新脚本无实际作用：
1.  找到`alarms.json`文件（默认在脚本目录，若安装时自定义了目录则在对应路径）；
2.  用文本编辑器打开文件，按照需求修改闹钟（修改名称/时间、添加新闹钟、删除无用闹钟）；
3.  保存文件（确保JSON格式正确，使用英文符号，无多余逗号）。

### 二、 核心步骤：运行`refresh.sh`脚本刷新生效
#### 步骤1：打开macOS终端
通过Spotlight搜索（`Command + 空格`）输入“终端”，打开终端应用。

#### 步骤2：切换到脚本所在目录
使用`cd`命令切换到`refresh.sh`所在的文件夹（与`install.sh`、`uninstall.sh`同一目录），示例命令（替换为你的实际路径）：
```bash
# 示例：脚本放在桌面的Tesuto-Alarm-Dec-2025文件夹
cd ~/Desktop/Tesuto-Alarm-Dec-2025
```
> 便捷技巧：可直接将脚本文件夹拖入终端，自动填充路径后回车即可切换。

#### 步骤3：（首次运行）赋予脚本执行权限
若之前未给`refresh.sh`赋予可执行权限，终端会提示权限不足，先执行以下命令授权（只需执行一次）：
```bash
chmod +x refresh.sh
```
> 若已给配套脚本授权过（如安装时一并授权），可跳过此步骤。

#### 步骤4：运行`refresh.sh`脚本
在终端中执行以下命令，启动刷新流程：
```bash
./refresh.sh
```

#### 步骤5：等待脚本自动执行操作
脚本运行后会自动完成以下流程，无需手动干预：
1.  首先检测Tesuto Alarm程序是否正在后台运行；
2.  若程序正在运行：自动停止程序进程 → 卸载旧的plist配置 → 重新加载新的配置（读取修改后的`alarms.json`） → 重启程序；
3.  若程序未运行：仅给出提示，不执行刷新操作（需手动启动程序或重新安装）。

### 三、 刷新成功验证
1.  **听觉验证（最直观）**：刷新完成后，若听到你指定的音频文件播放前2秒，说明刷新成功，修改后的闹钟配置已生效；
2.  **终端提示验证**：终端显示“在运行，已更新闹钟文件。请查看cirrus.log”，表明脚本已完成全部刷新操作；
3.  **日志验证**：打开脚本目录下的`tesuto.log`，若能看到“读取JSON成功”及修改后的闹钟信息，说明新配置已被程序加载。

### 四、 关键注意事项
1.  必须先保存`alarms.json`再运行`refresh.sh`，否则程序会读取旧的配置，修改无法生效；
2.  若脚本提示程序未运行，可按照终端提示手动加载配置，命令如下：
    ```bash
    launchctl load /Users/$(whoami)/Library/LaunchAgents/cn.org.cirrus.tesutoalarmdec2025.plist
    ```
3.  若刷新后闹钟未生效，先检查`alarms.json`格式是否正确（可查看`tesuto.error.log`排查错误），修正后重新运行`./refresh.sh`即可；
4.  刷新操作不会删除或修改`alarms.json`文件，仅重新加载该配置，可放心多次执行。

## 如何卸载
你想知道Tesuto Alarm闹钟程序的卸载方法，对吗？其实你已经贴心地编写了专用卸载脚本，操作非常简单便捷，具体分为**自动卸载（推荐，高效便捷）**和**手动卸载（备用，灵活可控）**两种方式，详细步骤如下：

### 一、 自动卸载（首选方式，一键完成）
这种方式直接使用你编写的 `uninstall.sh` 脚本，无需手动逐个清理文件，步骤如下：
1.  打开macOS终端（可通过 Spotlight 搜索“终端”打开）；
2.  通过 `cd` 命令切换到 `uninstall.sh` 脚本所在的目录（即你存放安装、刷新、卸载脚本的文件夹），示例命令：
    ```bash
    # 替换为你的脚本实际存放路径，比如放在桌面的Tesuto文件夹中
    cd ~/Desktop/Tesuto-Alarm-Dec-2025
    ```
3.  执行卸载脚本（若提示权限不足，添加 `sudo` 即可）：
    ```bash
    ./uninstall.sh
    ```
4.  等待脚本执行完成，终端会提示“alarms.json默认保留，可自行删除”，此时卸载已完成。

### 二、 手动卸载（备用方式，按需清理）
若你不想使用脚本，也可手动复刻脚本的操作步骤，逐一完成卸载，步骤如下：
1.  **停止并卸载程序进程（核心步骤）**
    打开终端，依次执行以下两条命令，终止程序运行并移除LaunchAgents配置：
    ```bash
    # 停止正在运行的Tesuto Alarm进程
    launchctl stop cn.org.cirrus.tesutoalarmdec2025
    # 卸载plist配置文件，取消开机自启和进程保活
    launchctl unload /Users/$(whoami)/Library/LaunchAgents/cn.org.cirrus.tesutoalarmdec2025.plist
    ```
2.  **删除LaunchAgents配置文件**
    执行命令删除存放于系统目录的plist文件：
    ```bash
    rm /Users/$(whoami)/Library/LaunchAgents/cn.org.cirrus.tesutoalarmdec2025.plist
    ```
3.  **删除脚本目录下的程序文件**
    先通过 `cd` 命令切换到脚本所在目录，再依次执行以下命令删除相关文件：
    ```bash
    # 删除日志文件
    rm tesuto.log
    rm tesuto.error.log
    # 删除Swift源码文件
    rm tesuto.swift
    # 删除编译后的二进制可执行文件
    rm tesuto
    # 删除本地plist配置文件
    rm cn.org.cirrus.tesutoalarmdec2025.plist
    ```
4.  **可选：删除闹钟配置文件**
    与自动卸载一致，`alarms.json` 会默认保留（避免你丢失闹钟配置数据），若无需保留，可手动在对应目录（默认在脚本目录，若安装时自定义了路径则在对应路径）删除该文件。

### 三、 卸载完成验证
卸载后，你可通过以下命令验证是否彻底卸载：
```bash
# 查看是否还有程序进程相关记录，若无输出则说明已彻底移除
launchctl list | grep -q cn.org.cirrus.tesutoalarmdec2025
```
若终端无任何返回结果，即表示程序已成功卸载，不会再开机自启或后台运行。

### 四、 关键说明
1.  两种卸载方式效果一致，自动卸载更高效，手动卸载更灵活（可按需保留部分文件，如日志文件用于排查问题）；
2.  卸载过程中不会删除用户核心数据（`alarms.json`），若后续需要重新安装，可直接复用该配置文件，无需重新编写闹钟信息；
3.  若提示“权限不足”，在命令前添加 `sudo` 并输入你的电脑登录密码即可（输入密码时终端不会显示明文，输入完成后回车即可）。
